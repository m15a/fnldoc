image: nixos/latest
packages:
  - nixos.git
secrets:
  - deb4e7d8-9cff-41bf-b44c-2a1a8d2629c1
  - dc2b856e-1a4b-4d71-84a1-3b4e767f1352
environment:
  NIX_CONFIG: experimental-features = nix-command flakes
  SRC_DIR: fnldoc
tasks:
  - check: |
      cd $SRC_DIR
      nix flake check
  - doc: |
      cd $SRC_DIR
      nix develop .#ci-doc --command bash -c "make doc"
      git config --local user.name 'NACAMURA Mitsuhiro'
      git config --local user.email m15@m15a.dev
      git add doc
      git commit -m "docs: auto update"
      git push
